---
title: "حل مشکل باز شدن بعضی از سایت‌ها در لینوکس با DNS-Over-TLS"
date: 2019-03-29T10:23:11+03:30
categories: ["لینوکس"]
---

چند وقتی هست که به لینوکس کوچ کردم و از همون اول متوجه شدم که بعضی از سایت‌ها مثلا گیت‌هاب با مشکل باز میشن و مجبور بودم که از ف*شکن استفاده کنم تا بتونم بهشون دسترسی پیدا کنم و از همون اول اطمینان داشتم که مشکل از DNS هست چون سایتایی که میخواستم بهشون درسترسی پیدا کنم ف*تر نبودن و بیشتر سایت‌ها درست باز میشدن. همچنین بعد از اینکه یه بار وصل میشدم و ف*شکن رو خاموش میکردم مشکل برطرف میشد.

چند وقت پیش‌ها که کلودفلر سرویس [1.1.1.1](https://1.1.1.1/) رو معرفی کرد با یه موضوع جدیدی به نام DNS-Over-HTTPS یا DNS-Over-TLS آشنایی پیدا کردم. همون موقع با کمی جستجو متوجه شدم هنوز به صورت گسترده قابل استفاده نیست و برای استفاده ازش باید یه سرویس روی کامپیوتر خودتون نصب کنید تا درخواست‌های DNS رو تبدیل کنه و روی بستر امن انتقال بده.

حدس میزدم که با استفاده از DNS زوی بستر امن بشه این مشکل رو حل کرد که حدسم هم درست بود.
با جستجو [این مقاله](https://www.linuxbabe.com/ubuntu/ubuntu-stubby-dns-over-tls) رو پیدا کردم که چجوری نصب و راه‌اندازی `stubby` رو خیلی کامل توضیح داده. وقتی `stubby` رو نصب کردید، باید DNS سیستم‌عاملتون رو به `127.0.0.1` تغییر بدید.

بعد از این برنامه‌ها (مثلا مرورگر) درخواست‌های DNS رو به `stubby` میفرستن و `stubby` درخواست‌ها رو روی بستر امن انتقال میده و برمیگردونه.

توی پیکربندی `stubby` تعریف کردم که بجای سرورهای پیشفرض از سرویس کلودفلر استفاده کنه که این محتویات پیکربندی `stubby` منه:

```
resolution_type: GETDNS_RESOLUTION_STUB
dns_transport_list:
  - GETDNS_TRANSPORT_TLS
tls_authentication: GETDNS_AUTHENTICATION_REQUIRED
tls_query_padding_blocksize: 128
edns_client_subnet_private : 1
round_robin_upstreams: 1
idle_timeout: 10000
listen_addresses:
  - 127.0.0.1
  - 0::1
upstream_recursive_servers:
 - address_data: 1.1.1.1
   tls_auth_name: "cloudflare-dns.com"
 - address_data: 1.0.0.1
   tls_auth_name: "cloudflare-dns.com"
```

بعدش هم کش DNS مرورگرم رو خالی کردم (برای کروم وارد آدرس `chrome://net-internals/#dns` بشین و روی دکمه `Clear host cache` کلیک کنید)

امیدوارم که اگه شما هم با همچین مشکلی مواجه هستید با استفاده از DNS-Over-TLS بتونید حلش کنید.
